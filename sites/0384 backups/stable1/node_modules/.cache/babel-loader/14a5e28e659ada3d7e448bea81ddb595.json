{"ast":null,"code":"import _classCallCheck from\"/root/0384full/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/root/0384full/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/root/0384full/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/root/0384full/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Container}from'react-bootstrap';import{Markup}from'interweave';import{Link}from'react-router-dom';import moment from'moment';import'moment/locale/ru';import alertSound from'../assets/sounds/alert.mp3';import fileImg from\"../assets/img/file.svg\";var Home=/*#__PURE__*/function(_React$Component){_inherits(Home,_React$Component);var _super=_createSuper(Home);function Home(props){var _this;_classCallCheck(this,Home);_this=_super.call(this,props);_this.audio=new Audio(alertSound);_this.state={error:null,isLoaded:false,posts:[],postLastId:'',toChange:''};return _this;}_createClass(Home,[{key:\"componentDidUpdate\",value:function componentDidUpdate(){var _this2=this;fetch('/api/home').then(function(res){return res.json();}).then(function(result){if(result[0].id!=_this2.state.postLastId){document.title='NEW|#0384';_this2.setState({postLastId:result[0].id,isLoaded:true,posts:result,toChange:{id:result[0].id}});}else{_this2.setState({isLoaded:true,posts:result});}},function(error){_this2.setState({isLoaded:true,error:error});});if(document.title=='NEW|#0384'){this.audio.play();setTimeout(function(){_this2.audio.pause();document.title='#0384';},1350);}}},{key:\"componentDidMount\",value:function componentDidMount(){var _this3=this;fetch('/api/home').then(function(res){return res.json();}).then(function(result){_this3.setState({isLoaded:true,posts:result,postLastId:result[0].id});},// Примечание: важно обрабатывать ошибки именно здесь, а не в блоке catch(),\n// чтобы не перехватывать исключения из ошибок в самих компонентах.\nfunction(error){_this3.setState({isLoaded:true,error:error});});}},{key:\"render\",value:function render(){var _this4=this;var _this$state=this.state,error=_this$state.error,isLoaded=_this$state.isLoaded,posts=_this$state.posts;var regex=/\\b(?:(?:ht|f)tp(?:s?)\\:\\/\\/|~\\/|\\/)?(?:\\w+:\\w+@)?((?:(?:[-\\w\\d{1-3}]+\\.)+(?:com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\\.uk|ac\\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2}))|((\\b25[0-5]\\b|\\b[2][0-4][0-9]\\b|\\b[0-1]?[0-9]?[0-9]\\b)(\\.(\\b25[0-5]\\b|\\b[2][0-4][0-9]\\b|\\b[0-1]?[0-9]?[0-9]\\b)){3}))(?::[\\d]{1,5})?(?:(?:(?:\\/(?:[-\\w~!$+|.,=]|%[a-f\\d]{2})+)+|\\/)+|\\?|#)?(?:(?:\\?(?:[-\\w~!$+|.,*:]|%[a-f\\d{2}])+=?(?:[-\\w~!$+|.,*:=]|%[a-f\\d]{2})*)(?:&(?:[-\\w~!$+|.,*:]|%[a-f\\d{2}])+=?(?:[-\\w~!$+|.,*:=]|%[a-f\\d]{2})*)*)*(?:#(?:[-\\w~!$ |\\/.,*:;=]|%[a-f\\d]{2})*)?\\b/gi;if(error){return/*#__PURE__*/React.createElement(\"div\",null,\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \",error.message);}else if(!isLoaded){return/*#__PURE__*/React.createElement(\"div\",{style:{width:'fit-content',margin:'0 auto'}},\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\");}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"page page-home\"},/*#__PURE__*/React.createElement(Container,null,posts.map(function(res,index){var stylemap={};if(_this4.state.toChange&&_this4.state.toChange.id==res.id){stylemap={boxShadow:'0 0 14px 0px green',transition:'.7s'};}return/*#__PURE__*/React.createElement(Link,{to:{pathname:\"/view\",state:{res:res}},className:\"info-block\",key:index,style:stylemap,onMouseOver:function onMouseOver(e){e.currentTarget.style.boxShadow='1px 1px 3px grey';}},/*#__PURE__*/React.createElement(\"span\",{className:\"info-block__title\"},res.title),/*#__PURE__*/React.createElement(\"span\",{className:\"info-block__content\"},/*#__PURE__*/React.createElement(Markup,{content:res.content.length>300?res.content.replace(regex,function(match){return\"<img src=\".concat(fileImg,\" width='50' />\");}).substring(0,300)+'...':res.content.replace(regex,function(match){return\"<img src=\".concat(fileImg,\" width='50' />\");})})),/*#__PURE__*/React.createElement(\"span\",{className:\"info-block__date\"},moment(res.date).locale('ru').format('lll')));})));}}}]);return Home;}(React.Component);export{Home as default};","map":{"version":3,"sources":["/root/0384full/src/pages/home.js"],"names":["React","Container","Markup","Link","moment","alertSound","Home","props","audio","Audio","state","error","isLoaded","posts","postLastId","toChange","fetch","then","res","json","result","id","document","title","setState","play","setTimeout","pause","regex","message","width","margin","map","index","stylemap","boxShadow","transition","pathname","e","currentTarget","style","content","length","replace","match","fileImg","substring","date","locale","format","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Container } from 'react-bootstrap';\r\nimport { Markup } from 'interweave';\r\n\r\nimport { Link } from 'react-router-dom';\r\nimport moment from 'moment';\r\nimport 'moment/locale/ru';\r\n\r\nimport alertSound from '../assets/sounds/alert.mp3';\r\nimport fileImg from '../assets/img/file.svg';\r\n\r\nexport default class Home extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.audio = new Audio(alertSound);\r\n\r\n    this.state = {\r\n      error: null,\r\n      isLoaded: false,\r\n      posts: [],\r\n      postLastId: '',\r\n      toChange: '',\r\n    };\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    fetch('/api/home')\r\n      .then((res) => res.json())\r\n      .then(\r\n        (result) => {\r\n          if (result[0].id != this.state.postLastId) {\r\n            document.title = 'NEW|#0384';\r\n            this.setState({\r\n              postLastId: result[0].id,\r\n              isLoaded: true,\r\n              posts: result,\r\n              toChange: {\r\n                id: result[0].id,\r\n              },\r\n            });\r\n          } else {\r\n            this.setState({\r\n              isLoaded: true,\r\n              posts: result,\r\n            });\r\n          }\r\n        },\r\n        (error) => {\r\n          this.setState({\r\n            isLoaded: true,\r\n            error,\r\n          });\r\n        },\r\n      );\r\n    if (document.title == 'NEW|#0384') {\r\n      this.audio.play();\r\n      setTimeout(() => {\r\n        this.audio.pause();\r\n        document.title = '#0384';\r\n      }, 1350);\r\n    }\r\n  }\r\n  componentDidMount() {\r\n    fetch('/api/home')\r\n      .then((res) => res.json())\r\n      .then(\r\n        (result) => {\r\n          this.setState({\r\n            isLoaded: true,\r\n            posts: result,\r\n            postLastId: result[0].id,\r\n          });\r\n        },\r\n        // Примечание: важно обрабатывать ошибки именно здесь, а не в блоке catch(),\r\n        // чтобы не перехватывать исключения из ошибок в самих компонентах.\r\n        (error) => {\r\n          this.setState({\r\n            isLoaded: true,\r\n            error,\r\n          });\r\n        },\r\n      );\r\n  }\r\n\r\n  render() {\r\n    const { error, isLoaded, posts } = this.state;\r\n\r\n    const regex = /\\b(?:(?:ht|f)tp(?:s?)\\:\\/\\/|~\\/|\\/)?(?:\\w+:\\w+@)?((?:(?:[-\\w\\d{1-3}]+\\.)+(?:com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\\.uk|ac\\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2}))|((\\b25[0-5]\\b|\\b[2][0-4][0-9]\\b|\\b[0-1]?[0-9]?[0-9]\\b)(\\.(\\b25[0-5]\\b|\\b[2][0-4][0-9]\\b|\\b[0-1]?[0-9]?[0-9]\\b)){3}))(?::[\\d]{1,5})?(?:(?:(?:\\/(?:[-\\w~!$+|.,=]|%[a-f\\d]{2})+)+|\\/)+|\\?|#)?(?:(?:\\?(?:[-\\w~!$+|.,*:]|%[a-f\\d{2}])+=?(?:[-\\w~!$+|.,*:=]|%[a-f\\d]{2})*)(?:&(?:[-\\w~!$+|.,*:]|%[a-f\\d{2}])+=?(?:[-\\w~!$+|.,*:=]|%[a-f\\d]{2})*)*)*(?:#(?:[-\\w~!$ |\\/.,*:;=]|%[a-f\\d]{2})*)?\\b/gi;\r\n\r\n    if (error) {\r\n      return <div>Ошибка: {error.message}</div>;\r\n    } else if (!isLoaded) {\r\n      return (\r\n        <div\r\n          style={{\r\n            width: 'fit-content',\r\n            margin: '0 auto',\r\n          }}>\r\n          Загрузка...\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"page page-home\">\r\n          <Container>\r\n            {posts.map((res, index) => {\r\n              let stylemap = {};\r\n              if (this.state.toChange && this.state.toChange.id == res.id) {\r\n                stylemap = {\r\n                  boxShadow: '0 0 14px 0px green',\r\n                  transition: '.7s',\r\n                };\r\n              }\r\n\r\n              return (\r\n                <Link\r\n                  to={{\r\n                    pathname: `/view`,\r\n                    state: { res },\r\n                  }}\r\n                  className=\"info-block\"\r\n                  key={index}\r\n                  style={stylemap}\r\n                  onMouseOver={(e) => {\r\n                    e.currentTarget.style.boxShadow = '1px 1px 3px grey';\r\n                  }}>\r\n                  <span className=\"info-block__title\">{res.title}</span>\r\n                  <span className=\"info-block__content\">\r\n                    <Markup\r\n                      content={\r\n                        res.content.length > 300\r\n                          ? res.content\r\n                              .replace(regex, (match) => {\r\n                                return `<img src=${fileImg} width='50' />`;\r\n                              })\r\n                              .substring(0, 300) + '...'\r\n                          : res.content.replace(regex, (match) => {\r\n                              return `<img src=${fileImg} width='50' />`;\r\n                            })\r\n                      }\r\n                    />\r\n                  </span>\r\n                  <span className=\"info-block__date\">\r\n                    {moment(res.date).locale('ru').format('lll')}\r\n                  </span>\r\n                </Link>\r\n              );\r\n            })}\r\n          </Container>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}