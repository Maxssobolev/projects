{"ast":null,"code":"var _jsxFileName = \"/root/0384full/src/components/calendar.js\";\nimport React from 'react';\nimport { Markup } from 'interweave';\nimport axios from 'axios';\nimport clip from '../assets/img/link.png';\nimport breaking from \"../assets/img/break.svg\";\nimport chill from \"../assets/img/chill.svg\";\nimport moment from 'moment';\nexport default class Calendar extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      prevSub: '',\n      currentSub: '',\n      nextSub: '',\n      time: Date.now(),\n      calendar: []\n    };\n  }\n\n  componentDidMount() {\n    var options = {\n      weekday: 'short',\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    };\n    var prnDt = new Date().toLocaleTimeString('en-us', options);\n    const [weekday, nowTime] = prnDt.split(' ');\n    const apiUrl = `/api/timetable/?day=${weekday}`;\n    axios.get(apiUrl).then(resp => {\n      if (resp.data.length > 0) {\n        this.setState({\n          calendar: resp.data\n        });\n      }\n    });\n  }\n\n  componentDidUpdate() {\n    let nowTime = moment(); //настоящее время\n\n    let prevSub = '';\n    let currentSub = '';\n    let nextSub = [];\n    let paraStart = [];\n    let isIbeforeAll = true,\n        firstPara = '';\n    let calendar = this.state.calendar;\n\n    if (calendar[0].flags !== 'weekend') {\n      for (let i in calendar) {\n        let startTime = moment(calendar[i].start, 'HH:mm'); //время начала пары\n\n        let endTime = moment(startTime).add({\n          hours: 1,\n          minutes: 25\n        }); //время окончания пары\n        //Если пара прошла\n\n        if (endTime.isBefore(nowTime)) {\n          prevSub = {\n            start: startTime.format('HH:mm'),\n            end: endTime.format('HH:mm'),\n            name: calendar[i].name,\n            link: calendar[i].link\n          };\n          isIbeforeAll = false;\n        } //Если пара идет\n        else if (startTime.isBefore(nowTime) && nowTime.isBefore(endTime)) {\n            currentSub = {\n              start: startTime.format('HH:mm'),\n              end: endTime.format('HH:mm'),\n              name: calendar[i].name + (calendar[i].link ? `<img src=${clip} width='15' style='margin-left: 5px;'>` : ''),\n              link: calendar[i].link\n            };\n            isIbeforeAll = false;\n          } //Если пара будет\n          else if (nowTime.isBefore(startTime)) {\n              nextSub.push({\n                start: startTime.format('HH:mm'),\n                end: endTime.format('HH:mm'),\n                name: calendar[i].name,\n                link: calendar[i].link\n              });\n              paraStart.push(startTime);\n\n              if (isIbeforeAll && !firstPara) {\n                // Если ни одной пары еще не было, берем во фьючер первую\n                let startTimef = moment(calendar[0].start, 'HH:mm'); //время начала пары\n\n                let endTimef = moment(startTimef).add({\n                  hours: 1,\n                  minutes: 25\n                }); //время окончания пары\n\n                firstPara = {\n                  startObj: startTimef,\n                  start: startTimef.format('HH:mm'),\n                  end: endTimef.format('HH:mm'),\n                  name: calendar[0].name,\n                  link: calendar[0].link\n                };\n              }\n            }\n      }\n\n      if (paraStart.length > 0) {\n        var different = paraStart[0].diff(nowTime);\n\n        if (firstPara) {\n          var different = nowTime.diff(firstPara.startObj);\n        }\n      } else {\n        var different = '';\n      }\n\n      let hours = different ? firstPara ? parseInt(Math.abs(Math.floor(different % 86400000 / 3600000))) - 1 : Math.floor(different % 86400000 / 3600000) : ''; //Почему то показывает на час больше - костыляем\n\n      let minutes = different ? Math.abs(Math.round(different % 86400000 % 3600000 / 60000)) : '';\n      let result = minutes ? (hours ? hours + ' ч ' : '') + minutes + ' мин' : '—— - ——';\n      setTimeout(() => {\n        this.setState({\n          prevSub: prevSub ? prevSub : '',\n          currentSub: currentSub ? currentSub : {\n            breaktime: result,\n            name: `перерыв <img src=${breaking} width='20' style='margin-bottom:5px'>`\n          },\n          nextSub: nextSub ? firstPara ? firstPara : nextSub[0] : ''\n        });\n      }, 1000);\n    } else {\n      //Если выходной\n      setTimeout(() => {\n        this.setState({\n          currentSub: currentSub ? currentSub : {\n            breaktime: '—— - ——',\n            name: `выходной <img src=${chill} width='20' style='margin-bottom:5px; transform:scale(-1,1)'>`\n          }\n        });\n      }, 1000);\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"calendar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 7\n      }\n    }, !this.state.currentSub && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        width: 'fit-content',\n        margin: '0 auto'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 11\n      }\n    }, \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0440\\u0430\\u0441\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u044F...\"), this.state.prevSub && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"prevSub\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"time\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 13\n      }\n    }, this.state.prevSub.start, \" - \", this.state.prevSub.end), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 13\n      }\n    }, this.state.prevSub.name)), this.state.currentSub && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"currentSub\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"time\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 13\n      }\n    }, this.state.currentSub.start && `\n              ${this.state.currentSub.start} - ${this.state.currentSub.end}`, this.state.currentSub.breaktime && this.state.currentSub.breaktime), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 13\n      }\n    }, this.state.currentSub.link && /*#__PURE__*/React.createElement(\"a\", {\n      href: this.state.currentSub.link,\n      target: \"_blank\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Markup, {\n      content: this.state.currentSub.name + `<span class=\"now\">(сейчас)</span>`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 19\n      }\n    }), ' '), !this.state.currentSub.link && !this.state.currentSub.breaktime && /*#__PURE__*/React.createElement(Markup, {\n      content: this.state.currentSub.name + `<span class=\"now\">(сейчас)</span>`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }\n    }), !this.state.currentSub.link && this.state.currentSub.breaktime && /*#__PURE__*/React.createElement(Markup, {\n      content: this.state.currentSub.name,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 17\n      }\n    }))), this.state.nextSub && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"nextSub\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"time\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 13\n      }\n    }, this.state.nextSub.start, \" - \", this.state.nextSub.end), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 13\n      }\n    }, this.state.nextSub.link && /*#__PURE__*/React.createElement(\"a\", {\n      href: this.state.nextSub.link,\n      target: \"_blank\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Markup, {\n      content: this.state.nextSub.name + `<img src=${clip} alt=\"(есть ссылка)\" width=\"15\" style='margin-left:5px' />`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 19\n      }\n    })), !this.state.nextSub.link && this.state.nextSub.name)));\n  }\n\n}","map":{"version":3,"sources":["/root/0384full/src/components/calendar.js"],"names":["React","Markup","axios","clip","moment","Calendar","Component","constructor","props","state","prevSub","currentSub","nextSub","time","Date","now","calendar","componentDidMount","options","weekday","hour","minute","hour12","prnDt","toLocaleTimeString","nowTime","split","apiUrl","get","then","resp","data","length","setState","componentDidUpdate","paraStart","isIbeforeAll","firstPara","flags","i","startTime","start","endTime","add","hours","minutes","isBefore","format","end","name","link","push","startTimef","endTimef","startObj","different","diff","parseInt","Math","abs","floor","round","result","setTimeout","breaktime","breaking","chill","render","width","margin"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Markup } from 'interweave';\r\nimport axios from 'axios';\r\nimport clip from '../assets/img/link.png';\r\nimport breaking from '../assets/img/break.svg';\r\nimport chill from '../assets/img/chill.svg';\r\n\r\nimport moment from 'moment';\r\n\r\nexport default class Calendar extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      prevSub: '',\r\n      currentSub: '',\r\n      nextSub: '',\r\n      time: Date.now(),\r\n      calendar: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    var options = { weekday: 'short', hour: '2-digit', minute: '2-digit', hour12: false };\r\n    var prnDt = new Date().toLocaleTimeString('en-us', options);\r\n    const [weekday, nowTime] = prnDt.split(' ');\r\n\r\n    const apiUrl = `/api/timetable/?day=${weekday}`;\r\n    axios.get(apiUrl).then((resp) => {\r\n      if (resp.data.length > 0) {\r\n        this.setState({\r\n          calendar: resp.data,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    let nowTime = moment(); //настоящее время\r\n\r\n    let prevSub = '';\r\n    let currentSub = '';\r\n    let nextSub = [];\r\n    let paraStart = [];\r\n    let isIbeforeAll = true,\r\n      firstPara = '';\r\n\r\n    let calendar = this.state.calendar;\r\n    if (calendar[0].flags !== 'weekend') {\r\n      for (let i in calendar) {\r\n        let startTime = moment(calendar[i].start, 'HH:mm'); //время начала пары\r\n        let endTime = moment(startTime).add({ hours: 1, minutes: 25 }); //время окончания пары\r\n\r\n        //Если пара прошла\r\n        if (endTime.isBefore(nowTime)) {\r\n          prevSub = {\r\n            start: startTime.format('HH:mm'),\r\n            end: endTime.format('HH:mm'),\r\n            name: calendar[i].name,\r\n            link: calendar[i].link,\r\n          };\r\n\r\n          isIbeforeAll = false;\r\n        }\r\n        //Если пара идет\r\n        else if (startTime.isBefore(nowTime) && nowTime.isBefore(endTime)) {\r\n          currentSub = {\r\n            start: startTime.format('HH:mm'),\r\n            end: endTime.format('HH:mm'),\r\n            name:\r\n              calendar[i].name +\r\n              (calendar[i].link ? `<img src=${clip} width='15' style='margin-left: 5px;'>` : ''),\r\n            link: calendar[i].link,\r\n          };\r\n          isIbeforeAll = false;\r\n        }\r\n        //Если пара будет\r\n        else if (nowTime.isBefore(startTime)) {\r\n          nextSub.push({\r\n            start: startTime.format('HH:mm'),\r\n            end: endTime.format('HH:mm'),\r\n            name: calendar[i].name,\r\n            link: calendar[i].link,\r\n          });\r\n          paraStart.push(startTime);\r\n\r\n          if (isIbeforeAll && !firstPara) {\r\n            // Если ни одной пары еще не было, берем во фьючер первую\r\n            let startTimef = moment(calendar[0].start, 'HH:mm'); //время начала пары\r\n            let endTimef = moment(startTimef).add({ hours: 1, minutes: 25 }); //время окончания пары\r\n            firstPara = {\r\n              startObj: startTimef,\r\n              start: startTimef.format('HH:mm'),\r\n              end: endTimef.format('HH:mm'),\r\n              name: calendar[0].name,\r\n              link: calendar[0].link,\r\n            };\r\n          }\r\n        }\r\n      }\r\n\r\n      if (paraStart.length > 0) {\r\n        var different = paraStart[0].diff(nowTime);\r\n        if (firstPara) {\r\n          var different = nowTime.diff(firstPara.startObj);\r\n        }\r\n      } else {\r\n        var different = '';\r\n      }\r\n\r\n      let hours = different\r\n        ? firstPara\r\n          ? parseInt(Math.abs(Math.floor((different % 86400000) / 3600000))) - 1\r\n          : Math.floor((different % 86400000) / 3600000)\r\n        : ''; //Почему то показывает на час больше - костыляем\r\n      let minutes = different\r\n        ? Math.abs(Math.round(((different % 86400000) % 3600000) / 60000))\r\n        : '';\r\n      let result = minutes ? (hours ? hours + ' ч ' : '') + minutes + ' мин' : '—— - ——';\r\n\r\n      setTimeout(() => {\r\n        this.setState({\r\n          prevSub: prevSub ? prevSub : '',\r\n          currentSub: currentSub\r\n            ? currentSub\r\n            : {\r\n                breaktime: result,\r\n                name: `перерыв <img src=${breaking} width='20' style='margin-bottom:5px'>`,\r\n              },\r\n          nextSub: nextSub ? (firstPara ? firstPara : nextSub[0]) : '',\r\n        });\r\n      }, 1000);\r\n    } else {\r\n      //Если выходной\r\n      setTimeout(() => {\r\n        this.setState({\r\n          currentSub: currentSub\r\n            ? currentSub\r\n            : {\r\n                breaktime: '—— - ——',\r\n                name: `выходной <img src=${chill} width='20' style='margin-bottom:5px; transform:scale(-1,1)'>`,\r\n              },\r\n        });\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"calendar\">\r\n        {!this.state.currentSub && (\r\n          <div\r\n            style={{\r\n              width: 'fit-content',\r\n              margin: '0 auto',\r\n            }}>\r\n            Загрузка расписания...\r\n          </div>\r\n        )}\r\n        {this.state.prevSub && (\r\n          <div className=\"prevSub\">\r\n            <span className=\"time\">\r\n              {this.state.prevSub.start} - {this.state.prevSub.end}\r\n            </span>\r\n\r\n            <span className=\"name\">{this.state.prevSub.name}</span>\r\n          </div>\r\n        )}\r\n        {this.state.currentSub && (\r\n          <div className=\"currentSub\">\r\n            <span className=\"time\">\r\n              {this.state.currentSub.start &&\r\n                `\r\n              ${this.state.currentSub.start} - ${this.state.currentSub.end}`}\r\n              {this.state.currentSub.breaktime && this.state.currentSub.breaktime}\r\n            </span>\r\n            <span className=\"name\">\r\n              {this.state.currentSub.link && (\r\n                <a href={this.state.currentSub.link} target=\"_blank\">\r\n                  <Markup\r\n                    content={this.state.currentSub.name + `<span class=\"now\">(сейчас)</span>`}\r\n                  />{' '}\r\n                </a>\r\n              )}\r\n\r\n              {!this.state.currentSub.link && !this.state.currentSub.breaktime && (\r\n                <Markup\r\n                  content={this.state.currentSub.name + `<span class=\"now\">(сейчас)</span>`}\r\n                />\r\n              )}\r\n              {!this.state.currentSub.link && this.state.currentSub.breaktime && (\r\n                <Markup content={this.state.currentSub.name} />\r\n              )}\r\n            </span>\r\n          </div>\r\n        )}\r\n        {this.state.nextSub && (\r\n          <div className=\"nextSub\">\r\n            <span className=\"time\">\r\n              {this.state.nextSub.start} - {this.state.nextSub.end}\r\n            </span>\r\n            <span className=\"name\">\r\n              {this.state.nextSub.link && (\r\n                <a href={this.state.nextSub.link} target=\"_blank\">\r\n                  <Markup\r\n                    content={\r\n                      this.state.nextSub.name +\r\n                      `<img src=${clip} alt=\"(есть ссылка)\" width=\"15\" style='margin-left:5px' />`\r\n                    }\r\n                  />\r\n                </a>\r\n              )}\r\n              {!this.state.nextSub.link && this.state.nextSub.name}\r\n            </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}